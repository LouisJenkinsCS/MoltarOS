section .text

	global switch_directory

		switch_directory:
			pusha
			
			; Obtain directory pointer and load it
			mov eax, [esp + 4]

			; Set the directory in CR3
			mov cr3, eax

			; Update CR0 to enable paging
			mov ebx, cr0
			or ebx, 0x80000000
			mov cr0, ebx

			; Necessary branching instruction...
			jmp .label
			nop
			nop
			.label:
				popa
				ret